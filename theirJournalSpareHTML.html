//from mail +change

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Text Self assign</title>
    <style>
    .blue {
        color:blue;
    }
    .pink {
        color: white;
    }
    .yellow{
       color: yellow;
    }
    #rte {
        width:700px;
        height:700px;
        background-color: brown;
        position: absolute;
        left: 300px;
        top: 200px;
    }
    </style>
</head>
<body>
    
    <h1 class='blue' > Their Journal</h1>
    <form action="/writeEntry" method="post">
        <textarea name="journal" id ="writingItDown" oninput= "copyTextToDiv()" rows="10" cols="30">...</textarea>
        <input type="submit" value="Submit">
    </form>

    <button name="storyTag" id="storyT" type="button">Tag as Story</button>
    <button name="gossipTag" id="gossipT" type="button">Tag as Gossip</button>
    <button name="otherTag" id="otherT" type="button">Tag as Neither</button>
    <br><br>
    <div id="rte" contenteditable="true">
    </div>
    <!-- <div id = "endContainer"> </div> -->
</body>
<script>


document.getElementById("gossipT").addEventListener("click", colorTheTextBlue);


function replaceSelectedText(el, text) {
    var sel = window.getSelection();
    console.log("in replace");
    console.log(sel);

    console.log(el.anchorOffset);
    console.log("LAKE TAHOE");

    console.log(el.focusOffset);
    console.log("EGYPT");
    console.log("el is: "+ el);

    document.getElementById(el).style.color = green;


    //el.classList.add("blue");

    // var z = document.createElement('span'); // is a node
    // z.innerHTML = el;
    // z.classList.add("blue");
    // document.getElementById("rte").appendChild(z);

}


function colorTheTextBlue(){
    var sel = window.getSelection();
    console.log(sel);
    //sel is not null, but it's just a string, not a range?
    console.log(sel.anchorOffset);
    console.log("DID IT CONSOLE LOG");
    var changedSel = "<div class='blue'>" + sel + "</div>";
    replaceSelectedText(sel, "changedSel");
}

function copyTextToDiv(){
    var ele = document.getElementById('writingItDown').value;
    //secondDivContent.innerHTML = firstDivContent.innerHTML;
    endContainer.innerHTML = ele;
}







function getCaretCharacterOffsetWithin(element) {
    var caretOffset = 0;
    var doc = element.ownerDocument || element.document;
    var win = doc.defaultView || doc.parentWindow;
    var sel;
    if (typeof win.getSelection != "undefined") {
        sel = win.getSelection();
        if (sel.rangeCount > 0) {
            var range = win.getSelection().getRangeAt(0);
            var preCaretRange = range.cloneRange();
            preCaretRange.selectNodeContents(element);
            preCaretRange.setEnd(range.endContainer, range.endOffset);
            caretOffset = preCaretRange.toString().length;
        }
    } else if ( (sel = doc.selection) && sel.type != "Control") {
        var textRange = sel.createRange();
        var preCaretTextRange = doc.body.createTextRange();
        preCaretTextRange.moveToElementText(element);
        preCaretTextRange.setEndPoint("EndToEnd", textRange);
        caretOffset = preCaretTextRange.text.length;
    }
    return caretOffset;
}


</script>

</html>